<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>TestAJAX</title>
    <script src="script/test.js"></script>
    <link href="css/css.css" rel="stylesheet">
    <!-- <script src="https://kjur.github.io/jsrsasign/jsrsasign-latest-all-min.js"></script> -->
    <script src="script/jsjws-3.2.min.js"></script>
  </head>
  <body>

    <div class="aes" id="as">

    </div>

    <form class="as" action="#" method="post">
      <input type="text" id="text" value=""/>
      <input type="text" id="valor" value=""/>
      <input type="button" value="Enviar" onclick="start()"/>
      <input type="button" value="GET" onclick="get()"/>
    </form>

    <script>

      var div = document.getElementById('as')

      var text = document.getElementById('text')

      var valor = document.getElementById('valor')

      //var a = document.getElementById('as')

      // console.log(KJUR.jws.IntDate.getNow());

      var xmlHttp

      var createXML = () => {

        if (!(typeof xmlHttp == 'object')) xmlHttp = new XMLHttpRequest()
      }

      var handleStateChange = () => {
        if (xmlHttp.readyState == 4)
          if (xmlHttp.status == 200)
            div.innerHTML = "<h1>"+xmlHttp.responseText+"</h1>"
      }

      var start = () => {

        createXML()

        var header = {alg: "HS512", typ: "JWT"};
        var payload = { name: text.value,pass: valor.value, date: jws.IntDate.getNow() };
        var jwt = KJUR.jws.JWS.sign("HS512", header, payload, {utf8: "secret"});

        xmlHttp.onreadystatechange = handleStateChange
        xmlHttp.open("POST", "/tests/"+jwt, true)
        xmlHttp.send(null)
      }

      var get = () => {

        createXML()
        xmlHttp.onreadystatechange = handleStateChange
        xmlHttp.open("GET", "/persona", true)
        xmlHttp.send(null)
      }


    </script>
  </body>
</html>

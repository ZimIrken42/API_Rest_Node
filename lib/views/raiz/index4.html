<!DOCTYPE html>
<meta charset="utf-8">
	<html ng-app="listaTelefonica">
	<head>
		<title>
			Lista Telefonica
		</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
		<script src="script/angular.js"></script>
		<script>

			var existeNumero = function (numero, numeros) {

				boleano = false
				numeros.forEach( function(elemento) {
					if (elemento.telefone === numero) boleano = (boleano || true);
				});
				return boleano;
			}

			angular.module("listaTelefonica", [])
			angular.module("listaTelefonica").controller("listaTelefonicaCtrl", function ($scope) {

				$scope.app = "Lista Telefonica"
				$scope.contatos = [
					{nome: "Pedro", telefone: "999999999", cor: {valor: "red"}},
					{nome: "carla", telefone: "999999977", cor: {valor: "yellow"}},
					{nome: "leandro", telefone: "999999669", cor: {valor: "green"}},
				]

				$scope.operadoras = [
					{nome: "Vivo", codigo: 15, categoria: "Celular"},
					{nome: "Oi", codigo: 14, categoria: "Celular"},
					{nome: "Tim", codigo: 41, categoria: "Celular"},
					{nome: "GVT", codigo: 21, categoria: "Fixo"},
					{nome: "Embratel", codigo: 20, categoria: "Fixo"}
				]

				$scope.cores = [
					{nome: "vermelho", valor: "red"},
					{nome: "amarelo", valor: "yellow"},
					{nome: "azul", valor: "blue"},
					{nome: "branco", valor: "write"}
				]

				$scope.adicionarContato = function (contato) {

					if (!!contato) {

						var regExp = /^(\(?\d{2}?\)?)?\s?-?\s?9?\s?-?\s?(\d{4})\s?-?\s?(\d{4})\s?$/ // expressÃ£o regular
						if (regExp.test(contato.telefone)) {

							$scope.numeroValido = false

							var contatoN = angular.copy(contato)
							var numeros = contatoN.telefone.split(regExp)
							contatoN.telefone = "9" + numeros[2].toString() + numeros[3].toString()
							if (existeNumero(contatoN.telefone, $scope.contatos)) {

								alert("Numero Ja Existe");
								delete $scope.contato.telefone
							} else {

								$scope.contatos.push(contatoN)
								delete $scope.contato
								$scope.contatosForm.$setPristine()
							}
						} else $scope.numeroValido = true
					} else alert("Digite um telefone")
				}
				$scope.removeContato = function (contatos) {

					$scope.contatos = contatos.filter((contato) => !contato.selecionado)
				}
				$scope.isContatoSelecionado = ((contatos) => contatos.some((contato) => contato.selecionado))
			})

		</script>
		<style>
			.jumbotron {
				width: 450px;
				text-align: left;
				margin-top: 20px;
				margin-left: auto;
				margin-right: auto;

			}
			.btn {
				margin-right: auto;
				margin-left: auto;

			}
			.titles {

				text-align: center;
			}
			.selecionado {

				background-color: yellow;
			}
			.negrito {

				font-weight: bold;
			}
		</style>
	</head>
	<body ng-controller="listaTelefonicaCtrl">


		<div class="jumbotron">
			<h3 ng-bind="app" class="titles"></h3>
			<table ng-show="contatos.length > 0" class="table">
				<tr>
					<th></th>
					<th>Nome</th>
					<th>Telefone</th>
					<th>Operadora</th>
					<th></th>
				</tr>
				<tr ng-class="{'negrito selecionado': contato.selecionado}" contato.selecionado" ng-repeat="contato in contatos">
					<td><input type="checkbox" ng-model="contato.selecionado"></td>
					<td ng-bind="contato.nome"></td>
					<td ng-bind="contato.telefone"></td>
					<td ng-bind="contato.operadora.nome"></td>
					<td><div style="width: 20px; height: 20px; background-color: {{contato.cor.valor}};"></div></td>
				</tr>
			</table>
			<hr/>

			<form name="contatosForm">
				<input class="form-control" type="text" ng-model="contato.nome" placeholder="nome" name="nome" ng-required="true" ng-minlength="10"/>
				<input class="form-control" type="text" ng-model="contato.telefone" placeholder="telefone" name="telefone" ng-required="true" ng-minlength="9"/>
				<select class="form-control" ng-model="contato.operadora" ng-options="operadora.nome group by operadora.categoria for operadora in operadoras">
					<option value="">Selecione uma operadora</option>
				</select>
				<!--<select class="form-control" ng-model="contato.cor" ng-options="cores.nome for cor in cores">
					<option value="">Selecione uma Cor</option>
				</select>-->
			</form>
			<div ng-show="contatosForm.nome.$error.required && contatosForm.nome.$dirty" class="alert alert-danger">
				Por favor, prencha o campo nome.
			</div>
			<div ng-show="contatosForm.nome.$error.minlength" class="alert alert-danger">
				O campo nome deve ter no minimo 10 caracteres.
			</div>
			<div ng-show="contatosForm.telefone.$error.required && contatosForm.telefone.$dirty" class="alert alert-danger">
				Por favor, prencha o campo telefone.
			</div>
			<div ng-show="numeroValido" class="alert alert-danger">
				O campo telefone deve ter um numero valido.
			</div>


			<button class="btn btn-block btn-primary" ng-click="adicionarContato(contato)" ng-disabled="contatosForm.$invalid">Adicionar Contato</button>
			<button class="btn btn-block btn-danger" ng-click="removeContato(contatos)" ng-show="isContatoSelecionado(contatos)">Remove Contato</button>

		</div>
		<div ng-include="'roda.html'">

		</div>
	</body>
</html>
